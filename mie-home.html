<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIE Home</title>

<script src="https://cdn.tailwindcss.com"></script>

<meta name="google-signin-client_id" content="514922143683-ja02ef5sm7ppsv79l216l5c18tlvtmg5.apps.googleusercontent.com">

<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 20px; text-align: center; background-color:#f3f4f6; }

  .calendar {
    width: 100%;
    max-width: 500px;
    height: 70vh; /* reactive height based on viewport */
    margin: auto;
    border: 1px solid #ccc;
    border-radius: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    overflow-y: auto; /* allow vertical scroll only if content exceeds */
    display: flex;
    flex-direction: column;
  }

  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f4f4f4;
    padding: 0.5em 1em;
    border-bottom: 1px solid #ddd;
    font-weight: bold;
  }

  .calendar-header button { background: none; border: none; font-size: 1.2em; cursor: pointer; flex: 0 0 auto; }
  .calendar-header span { font-size: 1.1em; flex:1; text-align:center; }

  .calendar-days, .calendar-dates { display: grid; grid-template-columns: repeat(7,1fr); }
  .calendar-days div { font-weight: bold; padding: 0.3em; font-size:0.9em; }
  .calendar-dates { flex: 1; overflow-y: auto; } /* make dates section grow & scrollable if needed */
  .calendar-dates div { padding:1em 0; font-size:0.9em; border-radius:6px; }
  .calendar-dates div:hover { background:#e6f2ff; }

  /* Responsive adjustments */
  @media(max-width:600px){
    .calendar { max-width:100%; border-radius:8px; height: 60vh; }
    .calendar-header span{font-size:1em;}
    .calendar-days div,.calendar-dates div{font-size:0.75em;}
  }
  @media(max-width:400px){
    .calendar-header span{font-size:0.9em;}
    .calendar-days div,.calendar-dates div{font-size:0.7em;}
  }

  .signin-container { margin-top: 20px; display:flex; justify-content:center; align-items:center; }
  .signin-status { margin-top: 10px; font-size: 14px; color: #666; }
</style>
</head>
<body>

<div class="calendar">
  <div class="calendar-header">
    <button onclick="changeMonth(-1)">&lt;</button>
    <span id="monthYear"></span>
    <button onclick="changeMonth(1)">&gt;</button>
  </div>
  <div class="calendar-days">
    <div>Sun</div><div>Mon</div><div>Tue</div>
    <div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
  </div>
  <div class="calendar-dates" id="calendarDates"></div>
</div>

<div class="signin-container">
  <div id="my-signin2"></div>
  <div id="signin-status" class="signin-status"></div>
</div>

<script>
/* ---------------- Calendar Logic ---------------- */
const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

function renderCalendar(month, year){
  document.getElementById("monthYear").textContent = monthNames[month]+" "+year;
  const dates = document.getElementById("calendarDates");
  dates.innerHTML="";
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1, 0).getDate();
  for(let i=0;i<firstDay;i++) dates.appendChild(document.createElement("div"));
  for(let i=1;i<=daysInMonth;i++){
    const day = document.createElement("div");
    day.textContent=i;
    dates.appendChild(day);
  }
}

function changeMonth(delta){
  currentMonth += delta;
  if(currentMonth>11){ currentMonth=0; currentYear++; }
  else if(currentMonth<0){ currentMonth=11; currentYear--; }
  renderCalendar(currentMonth, currentYear);
}

renderCalendar(currentMonth, currentYear);

/* ---------------- Google Sign-In Logic ---------------- */
function updateStatus(message) {
  document.getElementById("signin-status").textContent = message;
}

function onSuccess(googleUser){
  const accessToken = googleUser.getAuthResponse().access_token;
  const profile = googleUser.getBasicProfile();
  
  // Store token in sessionStorage
  sessionStorage.setItem("googleAccessToken", accessToken);
  
  console.log('Logged in as: ' + profile.getName());
  updateStatus('Login successful! Redirecting to dashboard...');
  
  // Small delay to show success message
  setTimeout(() => {
    window.location.href = "https://rylhong.github.io/mie-pages/dashboard.html";
  }, 1000);
}

function onFailure(error){
  console.error('Sign-in failed:', error);
  updateStatus('Sign-in failed. Please try again.');
}

function renderButton(){
  updateStatus('Loading sign-in...');
  
  gapi.signin2.render('my-signin2',{
    'scope':'profile email https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/gmail.send',
    'width':240,
    'height':50,
    'longtitle':true,
    'theme':'dark',
    'onsuccess':onSuccess,
    'onfailure':onFailure
  });
  
  updateStatus('Ready to sign in');
}
</script>

<script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>

</body>
</html>
