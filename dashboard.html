<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Google API Client Library (no longer used for auth; safe to leave) -->
<script src="https://apis.google.com/js/api.js"></script>

<!-- FullCalendar -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js"></script>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
            Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    }

    .oauth-app-container {
        max-width: 800px;
        margin: 24px auto;
        padding: 16px;
    }

    .calendar-section {
        width: 100%;
        height: 860px;
    }

    .messaging-section {
        width: 100%;
        height: 360px;
    }

    .gradient-border {
        border-radius: 16px;
        padding: 1px;
        background: linear-gradient(135deg, #3b82f6, #22c55e);
    }

    .inner-card {
        border-radius: 16px;
        background: #f9fafb;
    }

    .monospace-log {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
            "Liberation Mono", "Courier New", monospace;
        font-size: 11px;
    }

    /* --- Responsive Styles for Mobile (up to 480px wide) --- */
    @media (max-width: 480px) {
        .oauth-app-container {
            width: 100% !important;
        }
        .mobile-container {
            padding: 4px !important;
            gap: 4px !important;
        }
        .calendar-section,
        .messaging-section {
            width: 100% !important;
            height: auto !important;
            padding: 8px !important;
        }
        .mobile-heading {
            font-size: 20px !important;
            line-height: 1.2 !important;
        }
        .mobile-text {
            font-size: 14px !important;
            line-height: 1.25 !important;
        }
        .mobile-small-text {
            font-size: 11px !important;
        }
        .mobile-button {
            padding: 8px 12px !important;
            font-size: 14px !important;
        }
        .mobile-small-btn {
            padding: 4px 8px !important;
            font-size: 11px !important;
        }
        .fc-toolbar.fc-header-toolbar {
            flex-direction: column;
            align-items: flex-start;
            gap: 4px;
        }
        .fc-toolbar-title {
            font-size: 16px !important;
        }
        .fc-button {
            font-size: 10px !important;
            padding: 2px 6px !important;
        }
        .fc-daygrid-day-number {
            font-size: 11px !important;
        }
        .fc .fc-event {
            font-size: 10px !important;
        }
    }

    /* --- Responsive Styles for Tablet (481px to 768px) --- */
    @media (min-width: 481px) and (max-width: 768px) {
        .oauth-app-container {
            width: 481px;
        }
        .calendar-section {
            width: 481px;
            height: 632px;
        }
        .messaging-section {
            width: 481px;
            height: 316px;
        }
    }

    /* --- Responsive Styles for Desktop (769px and wider) --- */
    @media (min-width: 769px) {
        .oauth-app-container {
            width: 800px;
        }
        .calendar-section {
            width: 800px;
            height: 860px;
        }
        .messaging-section {
            width: 800px;
            height: 360px;
        }
    }

    /* --- FullCalendar Light Mode Customization --- */
    .fc {
        color: #1f2937 !important;
        background-color: #ffffff !important;
    }
    .fc .fc-button-primary {
        background-color: #3b82f6 !important;
        border-color: #2563eb !important;
        color: white !important;
    }
    .fc .fc-button-primary:hover {
        background-color: #2563eb !important;
    }
    .fc .fc-button-primary:disabled {
        background-color: #9ca3af !important;
        border-color: #6b7280 !important;
    }
    .fc-daygrid-day.fc-day-today {
        background-color: rgba(59, 130, 246, 0.1) !important;
    }
    .fc .fc-daygrid-day-frame {
        background-color: white !important;
    }
    .fc .fc-col-header-cell {
        background-color: #f8fafc !important;
        color: #1f2937 !important;
    }
    .fc .fc-daygrid-day-number {
        color: #1f2937 !important;
    }
    .fc .fc-event {
        border-color: #3b82f6 !important;
        background-color: #3b82f6 !important;
        color: white !important;
    }
    .fc .fc-toolbar-title {
        color: #1f2937 !important;
    }
    .fc .fc-daygrid-day.fc-day-other {
        display: none !important;
    }

    /* --- Event Modal Styling --- */
    .event-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.4);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    .event-modal:not(.hidden) {
        display: flex;
    }
    .event-modal-content {
        background: white;
        border-radius: 12px;
        padding: 24px;
        max-width: 480px;
        width: 100%;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        color: #1f2937;
    }
    @media (max-width: 480px) {
        .event-modal-content {
            max-width: 320px !important;
            padding: 16px !important;
        }
    }

    /* --- Access Denied Styling --- */
    .access-denied {
        border-radius: 12px;
        border: 1px solid #fecaca;
        background-color: #fef2f2;
        padding: 16px;
        color: #7f1d1d;
    }
</style>
</head>

<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen">
<div class="oauth-app-container">
    <div class="gradient-border shadow-xl">
        <div class="inner-card mobile-container bg-white rounded-2xl shadow-lg p-4 sm:p-6 flex flex-col gap-4">
            <!-- Top Header -->
            <div class="flex items-center justify-between mb-2">
                <div>
                    <h1 class="mobile-heading text-2xl font-semibold text-gray-800">Mie</h1>
                    <p class="mobile-text text-sm text-gray-500">Remember your life</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-gray-400 mobile-small-text">
                        Connected with Google Calendar
                    </p>
                    <a
                        href="https://calendar.google.com"
                        target="_blank"
                        class="text-xs text-blue-600 hover:text-blue-700 underline mobile-small-text"
                    >
                        Open Google Calendar
                    </a>
                </div>
            </div>

            <!-- Authentication Area (signed out / pre-consent) -->
            <div id="auth-area" class="flex flex-col items-center justify-start h-full p-4">
                <img
                    src="https://github.com/rylhong/mie-pages/blob/main/miemono_white_70x70.png?raw=true"
                    alt="Mie Logo"
                    class="rounded-full mb-4"
                />
                <h1
                    class="font-montserrat text-2xl font-semibold text-gray-800"
                    style="font-size: 18pt;"
                >
                    Mie
                </h1>
                <p
                    class="font-lato text-base text-gray-600 mt-1 mb-6"
                    style="font-size: 12pt;"
                >
                    Remember your life
                </p>

                <!-- Inline connect CTA - now uses Cloud Run backend -->
                <button
                    id="connect-google-btn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg shadow-sm mobile-button"
                >
                    Connect to Google
                </button>

                <p class="text-xs text-gray-500 mt-4 max-w-xs text-center mobile-small-text">
                    Mie will ask for permission to view your calendar and send notes to your
                    save@mie.today account.
                </p>
            </div>

            <!-- Access Verification Area -->
            <div
                id="access-check-area"
                class="hidden flex flex-col items-center justify-start h-full p-4"
            >
                <img
                    src="https://github.com/rylhong/mie-pages/blob/main/miemono_white_70x70.png?raw=true"
                    alt="Mie Logo"
                    class="rounded-full mb-4"
                />
                <h2 class="font-montserrat text-xl font-semibold text-gray-800 mb-4">
                    Verifying Access...
                </h2>
                <div
                    class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
                ></div>
                <p class="text-sm text-gray-600 mt-4">
                    Checking if your account has access to Mie dashboard
                </p>
            </div>

            <!-- Access Denied Area -->
            <div
                id="access-denied-area"
                class="hidden flex flex-col items-center justify-start h-full p-4"
            >
                <img
                    src="https://github.com/rylhong/mie-pages/blob/main/miemono_white_70x70.png?raw=true"
                    alt="Mie Logo"
                    class="rounded-full mb-4"
                />
                <h2 class="font-montserrat text-xl font-semibold text-red-600 mb-4">
                    Access Denied
                </h2>
                <div class="access-denied text-center max-w-md">
                    <p class="mb-3">
                        Your Gmail account doesn't have access to the Mie dashboard.
                    </p>
                    <p class="mb-4">
                        To get access, please sign up with the correct PIN code.
                    </p>
                    <div class="space-y-3">
                        <a
                            href="signup.html"
                            class="inline-block bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-semibold"
                        >
                            Sign Up for Access
                        </a>
                        <br />
                        <button
                            id="try-different-account"
                            class="text-blue-600 hover:text-blue-700 underline text-sm"
                        >
                            Try a Different Account
                        </button>
                    </div>
                </div>
            </div>

            <!-- Calendar Content (signed in + approved) -->
            <div id="calendar-content" class="hidden flex flex-col h-full">
                <div class="flex justify-between items-center mb-2">
                    <h2
                        class="mobile-heading text-xl font-semibold text-gray-800"
                    >
                        Calendar
                    </h2>
                    <div class="flex items-center">
                        <span
                            id="welcome-message"
                            class="text-sm text-gray-600"
                        ></span>
                    </div>
                </div>
                <div
                    id="calendar-container"
                    class="calendar-section bg-white rounded-xl shadow-inner border border-gray-200"
                ></div>
            </div>

            <!-- Messaging Section -->
            <div
                id="messaging-section"
                class="messaging-section bg-white rounded-xl shadow-lg p-4 flex flex-col hidden"
            >
                <h2 class="text-xl font-semibold mb-2 text-gray-800 mobile-heading">
                    Send a Message
                </h2>
                <p class="text-sm text-gray-500 mb-3 mobile-text">
                    Type a note and send it to your Mie inbox (save@mie.today).
                </p>

                <textarea
                    id="message-input"
                    class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-2"
                    rows="3"
                    placeholder="What do you want to remember?"
                ></textarea>

                <!-- Attachment area -->
                <div class="mb-3">
                    <label
                        for="file-input"
                        class="inline-flex items-center px-3 py-1 border border-gray-300 rounded-md text-xs text-gray-700 hover:bg-gray-50 cursor-pointer mobile-small-btn"
                    >
                        Attach image
                    </label>
                    <input
                        id="file-input"
                        type="file"
                        class="hidden"
                        accept="image/*"
                    />
                    <div
                        id="file-preview"
                        class="hidden flex items-center space-x-2 mt-2"
                    >
                        <img
                            id="preview-image"
                            class="w-12 h-12 object-cover rounded border"
                            alt="Preview"
                        />
                        <button
                            id="remove-file"
                            class="text-red-500 text-sm mobile-text"
                        >
                            Remove
                        </button>
                    </div>
                </div>

                <div class="flex items-center justify-between mb-2">
                    <button
                        id="send-button"
                        class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-4 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed mobile-button"
                        disabled
                    >
                        Send
                    </button>
                </div>

                <!-- Message Log -->
                <div
                    id="message-log"
                    class="monospace-log border border-gray-200 rounded-lg p-2 h-24 overflow-y-auto bg-gray-50 text-gray-700"
                ></div>

                <!-- Sign Out centered at bottom -->
                <div class="mt-4 flex justify-center">
                    <button
                        id="signout_button"
                        class="text-gray-500 text-xs font-semibold mobile-small-btn py-1 px-2 rounded-md"
                    >
                        Sign Out
                    </button>
                </div>
            </div>

            <!-- Event Modal -->
            <div id="event-modal" class="event-modal hidden">
                <div class="event-modal-content">
                    <div class="flex justify-between items-center mb-2">
                        <h3
                            id="event-title"
                            class="text-lg font-semibold text-gray-800"
                        >
                            Event Title
                        </h3>
                        <button
                            id="close-event-modal"
                            class="text-gray-500 hover:text-gray-700"
                        >
                            âœ•
                        </button>
                    </div>
                    <p
                        id="event-time"
                        class="text-sm text-gray-500 mb-1"
                    ></p>
                    <p
                        id="event-location"
                        class="text-sm text-gray-500 mb-2"
                    ></p>
                    <p
                        id="event-description"
                        class="text-sm text-gray-700 mb-4"
                    ></p>
                    <div class="flex justify-end">
                        <a
                            id="event-link"
                            target="_blank"
                            class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-4 py-2 rounded-lg"
                        >
                            Open in Google Calendar
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    // ======== CONFIG ========
    const BACKEND_BASE_URL = "https://mie-backend-514922143683.us-central1.run.app";

    // ======== STATE ========
    let calendar = null;
    let selectedFile = null;
    let userEmail = null;
    let userHasAccess = false;

    // ======== DOM HOOKS ========
    const authArea = document.getElementById("auth-area");
    const accessCheckArea = document.getElementById("access-check-area");
    const accessDeniedArea = document.getElementById("access-denied-area");
    const calendarContent = document.getElementById("calendar-content");
    const calendarContainer = document.getElementById("calendar-container");
    const messagingSection = document.getElementById("messaging-section");
    const welcomeMessage = document.getElementById("welcome-message");
    const signoutButton = document.getElementById("signout_button");
    const tryDifferentAccountBtn = document.getElementById("try-different-account");

    const connectGoogleBtn = document.getElementById("connect-google-btn");

    const sendButton = document.getElementById("send-button");
    const messageLog = document.getElementById("message-log");
    const messageInput = document.getElementById("message-input");
    const fileInput = document.getElementById("file-input");
    const filePreview = document.getElementById("file-preview");
    const previewImage = document.getElementById("preview-image");
    const removeFileBtn = document.getElementById("remove-file");

    const eventModal = document.getElementById("event-modal");
    const eventTitle = document.getElementById("event-title");
    const eventTime = document.getElementById("event-time");
    const eventDescription = document.getElementById("event-description");
    const eventLocation = document.getElementById("event-location");
    const eventLink = document.getElementById("event-link");
    const eventModalCloseBtn = document.getElementById("close-event-modal");

    // ======== INIT ========
    document.addEventListener("DOMContentLoaded", () => {
        bindEventHandlers();
        initializeDashboard();
    });

    function bindEventHandlers() {
        if (connectGoogleBtn) {
            connectGoogleBtn.addEventListener("click", () => {
                // Hand off OAuth to Cloud Run backend
                window.location.href = BACKEND_BASE_URL + "/auth/google";
            });
        }

        if (signoutButton) {
            signoutButton.addEventListener("click", handleSignOut);
        }

        if (tryDifferentAccountBtn) {
            tryDifferentAccountBtn.addEventListener("click", async () => {
                await handleSignOut(true);
                window.location.href = BACKEND_BASE_URL + "/auth/google";
            });
        }

        if (messageInput) {
            messageInput.addEventListener("input", updateSendButton);
        }

        if (fileInput) {
            fileInput.addEventListener("change", handleFileChange);
        }

        if (removeFileBtn) {
            removeFileBtn.addEventListener("click", (e) => {
                e.preventDefault();
                clearSelectedFile();
            });
        }

        if (sendButton) {
            sendButton.addEventListener("click", (e) => {
                e.preventDefault();
                sendEmail();
            });
        }

        if (eventModalCloseBtn) {
            eventModalCloseBtn.addEventListener("click", hideEventModal);
        }
        if (eventModal) {
            eventModal.addEventListener("click", (e) => {
                if (e.target === eventModal) {
                    hideEventModal();
                }
            });
        }

        updateSendButton();
    }

    // ======== HIGH-LEVEL FLOW ========
    async function initializeDashboard() {
        showAccessCheck();
        try {
            const resp = await fetch(BACKEND_BASE_URL + "/api/me/status", {
                method: "GET",
                credentials: "include"
            });
            if (!resp.ok) {
                console.warn("Status check failed with HTTP", resp.status);
                showAuthArea();
                return;
            }
            const data = await resp.json();
            if (data.connected) {
                userHasAccess = true;
                userEmail =
                    data.userEmail ||
                    (data.user && (data.user.email || data.user.primaryEmail)) ||
                    "";
                if (userEmail && welcomeMessage) {
                    welcomeMessage.textContent = "Welcome, " + userEmail;
                }
                showDashboard();
                displayMonthlyCalendar();
            } else {
                showAuthArea();
            }
        } catch (err) {
            console.error("Error during status check:", err);
            showAuthArea();
        }
    }

    // ======== UI STATE HELPERS ========
    function showAuthArea() {
        if (authArea) authArea.classList.remove("hidden");
        if (accessCheckArea) accessCheckArea.classList.add("hidden");
        if (accessDeniedArea) accessDeniedArea.classList.add("hidden");
        if (calendarContent) calendarContent.classList.add("hidden");
        if (messagingSection) messagingSection.classList.add("hidden");
    }

    function showAccessCheck() {
        if (authArea) authArea.classList.add("hidden");
        if (accessCheckArea) accessCheckArea.classList.remove("hidden");
        if (accessDeniedArea) accessDeniedArea.classList.add("hidden");
        if (calendarContent) calendarContent.classList.add("hidden");
        if (messagingSection) messagingSection.classList.add("hidden");
    }

    function showAccessDenied() {
        if (authArea) authArea.classList.add("hidden");
        if (accessCheckArea) accessCheckArea.classList.add("hidden");
        if (accessDeniedArea) accessDeniedArea.classList.remove("hidden");
        if (calendarContent) calendarContent.classList.add("hidden");
        if (messagingSection) messagingSection.classList.add("hidden");
    }

    function showDashboard() {
        if (authArea) authArea.classList.add("hidden");
        if (accessCheckArea) accessCheckArea.classList.add("hidden");
        if (accessDeniedArea) accessDeniedArea.classList.add("hidden");
        if (calendarContent) calendarContent.classList.remove("hidden");
        if (messagingSection) messagingSection.classList.remove("hidden");
    }

    // ======== SIGN OUT ========
    async function handleSignOut(silent) {
        try {
            await fetch(BACKEND_BASE_URL + "/auth/logout", {
                method: "POST",
                credentials: "include"
            });
        } catch (err) {
            console.error("Error during logout:", err);
        }
        if (!silent) {
            // Hard reset to dashboard for a clean state
            window.location.href = "https://mie.today/dashboard";
        }
    }

    // ======== CALENDAR RENDERING ========
    function displayMonthlyCalendar() {
        if (!calendarContainer) {
            console.error("Calendar container not found");
            return;
        }

        if (calendar) {
            calendar.destroy();
            calendar = null;
        }

        calendar = new FullCalendar.Calendar(calendarContainer, {
            initialView: "dayGridMonth",
            headerToolbar: {
                left: "prev,next today",
                center: "title",
                right: "dayGridMonth,timeGridWeek,timeGridDay"
            },
            height: "100%",
            events: fetchCalendarEvents,
            eventClick: (info) => {
                info.jsEvent.preventDefault();
                showEventModal(info.event);
            }
        });

        calendar.render();
    }

    async function fetchCalendarEvents(fetchInfo, successCallback, failureCallback) {
        try {
            const resp = await fetch(BACKEND_BASE_URL + "/api/me/events", {
                method: "GET",
                credentials: "include"
            });
            if (!resp.ok) {
                console.error("Events fetch failed with HTTP", resp.status);
                if (failureCallback) failureCallback(new Error("HTTP " + resp.status));
                return;
            }
            const data = await resp.json();
            const items = Array.isArray(data.events) ? data.events : [];
            const events = items.map(transformEventForCalendar);
            successCallback(events);
        } catch (err) {
            console.error("Error fetching events:", err);
            if (failureCallback) failureCallback(err);
        }
    }

    function transformEventForCalendar(e) {
        const start = (e.start && (e.start.dateTime || e.start.date)) || null;
        const end = (e.end && (e.end.dateTime || e.end.date)) || null;
        const allDay = !!(e.start && e.start.date && !e.start.dateTime);

        return {
            id: e.id,
            title: e.summary || "No Title",
            start,
            end,
            allDay,
            url: e.htmlLink || "",
            extendedProps: {
                description: e.description || "",
                location: e.location || "",
                hangoutLink:
                    e.hangoutLink ||
                    (e.conferenceData &&
                        Array.isArray(e.conferenceData.entryPoints) &&
                        e.conferenceData.entryPoints.length > 0
                        ? e.conferenceData.entryPoints[0].uri
                        : "")
            }
        };
    }

    // ======== EVENT MODAL ========
    function showEventModal(event) {
        if (!eventModal) return;

        eventTitle.textContent = event.title || "No Title";

        const startDate = event.start;
        let timeString = "";
        if (!event.allDay && startDate instanceof Date) {
            timeString = startDate.toLocaleTimeString([], {
                hour: "numeric",
                minute: "2-digit"
            });
        }

        if (startDate instanceof Date) {
            eventTime.textContent =
                startDate.toLocaleDateString() + (event.allDay ? "" : " | " + timeString);
        } else {
            eventTime.textContent = "";
        }

        eventDescription.textContent =
            event.extendedProps && event.extendedProps.description
                ? event.extendedProps.description
                : "No description provided.";

        eventLocation.textContent =
            event.extendedProps && event.extendedProps.location
                ? event.extendedProps.location
                : "No location provided.";

        if (event.url) {
            eventLink.href = event.url;
            eventLink.classList.remove("pointer-events-none", "opacity-50");
        } else {
            eventLink.href = "#";
            eventLink.classList.add("pointer-events-none", "opacity-50");
        }

        eventModal.classList.remove("hidden");
    }

    function hideEventModal() {
        if (eventModal) {
            eventModal.classList.add("hidden");
        }
    }

    // ======== MESSAGING ========
    async function sendEmail() {
        if (!userHasAccess) {
            logMessage("Error: Not connected to Google.", "error");
            return;
        }

        const text = (messageInput && messageInput.value) ? messageInput.value.trim() : "";
        if (!text && !selectedFile) {
            return;
        }

        logMessage("Sending message...", "info");
        if (sendButton) sendButton.disabled = true;

        try {
            // NOTE: Backend currently expects JSON text only.
            // Attachments are previewed in the UI but not yet sent.
            const resp = await fetch(BACKEND_BASE_URL + "/api/me/message", {
                method: "POST",
                credentials: "include",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ text })
            });

            if (!resp.ok) {
                console.error("Send message failed with HTTP", resp.status);
                logMessage("Failed to send message. Please try again.", "error");
                return;
            }

            logMessage("Message sent.", "success");
            if (messageInput) messageInput.value = "";
            clearSelectedFile();
        } catch (err) {
            console.error("Error sending message:", err);
            logMessage("Error sending message. Please try again.", "error");
        } finally {
            updateSendButton();
        }
    }

    function handleFileChange(e) {
        const file = e.target.files && e.target.files[0];
        if (!file) {
            clearSelectedFile();
            return;
        }
        selectedFile = file;

        if (filePreview && previewImage) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                previewImage.src = ev.target.result;
                filePreview.classList.remove("hidden");
            };
            reader.readAsDataURL(file);
        }

        updateSendButton();
    }

    function clearSelectedFile() {
        selectedFile = null;
        if (fileInput) {
            fileInput.value = "";
        }
        if (filePreview) {
            filePreview.classList.add("hidden");
        }
        updateSendButton();
    }

    function logMessage(msg, type) {
        if (!messageLog) return;
        const entry = document.createElement("div");
        entry.className = "text-xs mb-1";

        if (type === "error") {
            entry.classList.add("text-red-600");
        } else if (type === "success") {
            entry.classList.add("text-green-600");
        } else {
            entry.classList.add("text-gray-600");
        }

        const timestamp = new Date().toLocaleTimeString();
        entry.textContent = "[" + timestamp + "] " + msg;
        messageLog.prepend(entry);
    }

    function updateSendButton() {
        if (!sendButton) return;
        const canSend =
            (messageInput && messageInput.value.trim() !== "") || selectedFile !== null;
        sendButton.disabled = !canSend;
    }
})();
</script>
</body>
</html>
